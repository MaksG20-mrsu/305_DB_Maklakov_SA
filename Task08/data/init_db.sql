-- Лабораторная работа 8: CRUD-приложение
-- База данных для учета студентов и экзаменов
-- PostgreSQL

-- Удаление существующих таблиц
DROP TABLE IF EXISTS exams CASCADE;
DROP TABLE IF EXISTS disciplines CASCADE;
DROP TABLE IF EXISTS students CASCADE;
DROP TABLE IF EXISTS groups CASCADE;

-- Таблица групп
CREATE TABLE groups (
    id SERIAL PRIMARY KEY,
    number VARCHAR(10) NOT NULL UNIQUE,
    major VARCHAR(255) NOT NULL,
    start_year INT NOT NULL,
    grad_year INT NOT NULL
);

-- Таблица студентов
CREATE TABLE students (
    id SERIAL PRIMARY KEY,
    group_id INT NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
    full_name VARCHAR(255) NOT NULL,
    gender VARCHAR(1) NOT NULL CHECK (gender IN ('М', 'Ж')),
    birth_date DATE NOT NULL,
    student_card_number VARCHAR(20) NOT NULL UNIQUE,
    subgroup SMALLINT DEFAULT 1 CHECK (subgroup IN (1, 2))
);

-- Таблица дисциплин
CREATE TABLE disciplines (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    course INT NOT NULL CHECK (course BETWEEN 1 AND 4),
    semester INT NOT NULL CHECK (semester BETWEEN 1 AND 8),
    major VARCHAR(255) NOT NULL,
    exam_type VARCHAR(10) NOT NULL CHECK (exam_type IN ('экзамен', 'зачет'))
);

-- Таблица экзаменов
CREATE TABLE exams (
    id SERIAL PRIMARY KEY,
    student_id INT NOT NULL REFERENCES students(id) ON DELETE CASCADE,
    discipline_id INT NOT NULL REFERENCES disciplines(id) ON DELETE CASCADE,
    exam_date DATE NOT NULL,
    grade VARCHAR(20) NOT NULL CHECK (grade IN ('2', '3', '4', '5', 'зачет', 'незачет')),
    UNIQUE(student_id, discipline_id, exam_date)
);

-- Заполнение групп (3 курс - начало обучения 2023)
INSERT INTO groups (number, major, start_year, grad_year) VALUES
('305(1)', '09.03.04 Программная инженерия', 2023, 2027),
('305(2)', '09.03.04 Программная инженерия', 2023, 2027);

-- Заполнение студентов (данные из Task07)
INSERT INTO students (group_id, full_name, student_card_number, gender, birth_date, subgroup) VALUES
-- Подгруппа 1
(1, 'Зубков Роман Сергеевич', '231544', 'М', '2005-05-12', 1),
(1, 'Иванов Максим Александрович', '231553', 'М', '2005-03-15', 1),
(1, 'Ивенин Артём Андреевич', '230274', 'М', '2005-07-20', 1),
(1, 'Кочнев Артем Алексеевич', '231554', 'М', '2005-09-05', 1),
(1, 'Логунов Илья Сергеевич', '231551', 'М', '2005-11-23', 1),
(1, 'Макарова Юлия Сергеевна', '231540', 'Ж', '2005-04-18', 1),
(1, 'Маскинскова Наталья Сергеевна', '231536', 'Ж', '2005-06-30', 1),
(1, 'Мукасеев Дмитрий Александрович', '230026', 'М', '2005-08-14', 1),
(1, 'Наумкин Владислав Валерьевич', '231532', 'М', '2005-10-02', 1),
(1, 'Томилин Илья Петрович', '220325', 'М', '2005-04-05', 1),
(1, 'Рыбаков Евгений Геннадьевич', '231550', 'М', '2005-09-29', 1),
(1, 'Шушев Денис Сергеевич', '231969', 'М', '2005-01-30', 1),
-- Подгруппа 2
(2, 'Казейкин Иван Иванович', '231527', 'М', '2005-01-10', 2),
(2, 'Маклаков Сергей Александрович', '240021', 'М', '2005-02-27', 2),
(2, 'Паркаев Василий Александрович', '231533', 'М', '2005-12-12', 2),
(2, 'Полковников Дмитрий Александрович', '231556', 'М', '2005-01-25', 2),
(2, 'Пузаков Дмитрий Александрович', '231537', 'М', '2005-03-08', 2),
(2, 'Пшеницына Полина Алексеевна', '231523', 'Ж', '2005-05-19', 2),
(2, 'Пяткин Игорь Алексеевич', '231525', 'М', '2005-07-07', 2),
(2, 'Рыжкин Владислав Дмитриевич', '231538', 'М', '2005-11-01', 2),
(2, 'Рябченко Александра Станиславовна', '231518', 'Ж', '2005-02-14', 2),
(2, 'Тульсков Илья Андреевич', '231531', 'М', '2005-06-22', 2),
(2, 'Фирстов Артём Александрович', '231545', 'М', '2005-08-30', 2),
(2, 'Четайкин Владислав Александрович', '240022', 'М', '2005-10-15', 2),
(2, 'Шарунов Максим Игоревич', '231528', 'М', '2005-12-05', 2);

-- Заполнение дисциплин по учебному плану с типами аттестации
-- Курс 1, Семестр 1
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('История России', 1, 1, '09.03.04 Программная инженерия', 'экзамен'),
('Основы российской государственности', 1, 1, '09.03.04 Программная инженерия', 'зачет'),
('Физическая культура и спорт', 1, 1, '09.03.04 Программная инженерия', 'зачет'),
('Иностранный язык', 1, 1, '09.03.04 Программная инженерия', 'зачет'),
('Линейная алгебра и аналитическая геометрия', 1, 1, '09.03.04 Программная инженерия', 'экзамен'),
('Математический анализ', 1, 1, '09.03.04 Программная инженерия', 'экзамен'),
('Введение в искусственный интеллект', 1, 1, '09.03.04 Программная инженерия', 'экзамен'),
('Основы компьютерной архитектуры', 1, 1, '09.03.04 Программная инженерия', 'экзамен'),
('Основы программирования', 1, 1, '09.03.04 Программная инженерия', 'экзамен');

-- Курс 1, Семестр 2
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Иностранный язык', 1, 2, '09.03.04 Программная инженерия', 'зачет'),
('Безопасность жизнедеятельности', 1, 2, '09.03.04 Программная инженерия', 'зачет'),
('Математический анализ', 1, 2, '09.03.04 Программная инженерия', 'экзамен'),
('Дискретная математика', 1, 2, '09.03.04 Программная инженерия', 'экзамен'),
('Основы программирования', 1, 2, '09.03.04 Программная инженерия', 'экзамен'),
('Алгоритмы и структуры данных', 1, 2, '09.03.04 Программная инженерия', 'экзамен'),
('Современные языки программирования систем ИИ', 1, 2, '09.03.04 Программная инженерия', 'экзамен');

-- Курс 2, Семестр 3
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Иностранный язык', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Культура делового общения', 2, 3, '09.03.04 Программная инженерия', 'зачет'),
('Теория вероятностей и математическая статистика', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Методы оптимизации и исследование операций', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Теория автоматов и формальных языков', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Объектно-ориентированное программирование', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Дополнительные главы математического анализа', 2, 3, '09.03.04 Программная инженерия', 'экзамен'),
('Основы проектной деятельности', 2, 3, '09.03.04 Программная инженерия', 'зачет');

-- Курс 2, Семестр 4
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Иностранный язык', 2, 4, '09.03.04 Программная инженерия', 'зачет'),
('Экономика', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Вычислительная математика', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Дифференциальные уравнения', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Физика', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Теория информации', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Интеллектуальный анализ данных', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Основы высокопроизводительных вычислений', 2, 4, '09.03.04 Программная инженерия', 'экзамен'),
('Математические основы искусственного интеллекта', 2, 4, '09.03.04 Программная инженерия', 'экзамен');

-- Курс 3, Семестр 5
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Правоведение', 3, 5, '09.03.04 Программная инженерия', 'зачет'),
('Математическая логика и теория алгоритмов', 3, 5, '09.03.04 Программная инженерия', 'экзамен'),
('Основы электротехники и электроники', 3, 5, '09.03.04 Программная инженерия', 'экзамен'),
('Экономика программной инженерии', 3, 5, '09.03.04 Программная инженерия', 'зачет'),
('Основы нечеткой алгебры', 3, 5, '09.03.04 Программная инженерия', 'экзамен'),
('Базы данных', 3, 5, '09.03.04 Программная инженерия', 'экзамен'),
('Машинное обучение', 3, 5, '09.03.04 Программная инженерия', 'экзамен'),
('Методы визуализации данных', 3, 5, '09.03.04 Программная инженерия', 'зачет');

-- Курс 3, Семестр 6
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Философия', 3, 6, '09.03.04 Программная инженерия', 'экзамен'),
('Операционные системы', 3, 6, '09.03.04 Программная инженерия', 'экзамен'),
('Функциональное и логическое программирование', 3, 6, '09.03.04 Программная инженерия', 'экзамен'),
('Имитационное моделирование', 3, 6, '09.03.04 Программная инженерия', 'зачет'),
('Проектирование и архитектура программных систем', 3, 6, '09.03.04 Программная инженерия', 'экзамен'),
('Глубокое обучение', 3, 6, '09.03.04 Программная инженерия', 'экзамен');

-- Курс 4, Семестр 7
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Основы робототехники', 4, 7, '09.03.04 Программная инженерия', 'зачет'),
('Этика искусственного интеллекта', 4, 7, '09.03.04 Программная инженерия', 'зачет'),
('Тестирование программного обеспечения', 4, 7, '09.03.04 Программная инженерия', 'экзамен'),
('Введение в обработку естественного языка', 4, 7, '09.03.04 Программная инженерия', 'экзамен'),
('Инженерия данных', 4, 7, '09.03.04 Программная инженерия', 'экзамен'),
('Экспертные системы', 4, 7, '09.03.04 Программная инженерия', 'зачет'),
('Обучение с подкреплением', 4, 7, '09.03.04 Программная инженерия', 'зачет'),
('Методы асинхронного программирования в веб-разработке', 4, 7, '09.03.04 Программная инженерия', 'экзамен');

-- Курс 4, Семестр 8
INSERT INTO disciplines (name, course, semester, major, exam_type) VALUES
('Информационная безопасность', 4, 8, '09.03.04 Программная инженерия', 'экзамен'),
('Рекомендательные системы', 4, 8, '09.03.04 Программная инженерия', 'зачет'),
('Введение в компьютерное зрение', 4, 8, '09.03.04 Программная инженерия', 'экзамен'),
('Технологии разработки серверных приложений на PHP', 4, 8, '09.03.04 Программная инженерия', 'зачет'),
('Управление проектами в сфере ИТ', 4, 8, '09.03.04 Программная инженерия', 'экзамен');

-- Заполнение тестовых экзаменов
-- Студенты на 3 курсе (начали в 2023, сейчас 2025-2026 учебный год, 5 семестр закончился)
INSERT INTO exams (student_id, discipline_id, exam_date, grade) VALUES
-- Экзамены для первого студента (Зубков Р.С.) - отличник
-- 1 курс, 1 семестр (зима 2024)
(1, 1, '2024-01-15', '5'),      -- История России (экзамен)
(1, 2, '2024-01-10', 'зачет'),  -- Основы рос. государственности (зачет)
(1, 3, '2024-01-12', 'зачет'),  -- Физическая культура (зачет)
(1, 4, '2024-01-14', 'зачет'),  -- Иностранный язык (зачет)
(1, 5, '2024-01-20', '5'),      -- Линейная алгебра (экзамен)
(1, 6, '2024-01-22', '5'),      -- Математический анализ (экзамен)
(1, 7, '2024-01-24', '5'),      -- Введение в ИИ (экзамен)
(1, 8, '2024-01-26', '5'),      -- Основы компьютерной архитектуры (экзамен)
(1, 9, '2024-01-28', '5'),      -- Основы программирования (экзамен)

-- 1 курс, 2 семестр (лето 2024)
(1, 10, '2024-06-05', 'зачет'), -- Иностранный язык (зачет)
(1, 11, '2024-06-07', 'зачет'), -- Безопасность (зачет)
(1, 12, '2024-06-10', '5'),     -- Математический анализ (экзамен)
(1, 13, '2024-06-12', '5'),     -- Дискретная математика (экзамен)
(1, 14, '2024-06-14', '5'),     -- Основы программирования (экзамен)
(1, 15, '2024-06-16', '5'),     -- Алгоритмы и структуры данных (экзамен)
(1, 16, '2024-06-18', '5'),     -- Современные языки программирования (экзамен)

-- 2 курс, 3 семестр (зима 2025)
(1, 17, '2025-01-10', '5'),     -- Иностранный язык (экзамен)
(1, 18, '2025-01-08', 'зачет'), -- Культура делового общения (зачет)
(1, 19, '2025-01-12', '5'),     -- Теория вероятностей (экзамен)
(1, 20, '2025-01-14', '5'),     -- Методы оптимизации (экзамен)
(1, 21, '2025-01-16', '5'),     -- Теория автоматов (экзамен)
(1, 22, '2025-01-18', '5'),     -- ООП (экзамен)
(1, 23, '2025-01-20', '5'),     -- Доп. главы мат. анализа (экзамен)
(1, 24, '2025-01-15', 'зачет'), -- Основы проектной деятельности (зачет)

-- 2 курс, 4 семестр (лето 2025)
(1, 25, '2025-06-05', 'зачет'), -- Иностранный язык (зачет)
(1, 26, '2025-06-10', '4'),     -- Экономика (экзамен)
(1, 27, '2025-06-12', '5'),     -- Вычислительная математика (экзамен)
(1, 28, '2025-06-14', '5'),     -- Дифференциальные уравнения (экзамен)
(1, 29, '2025-06-16', '5'),     -- Физика (экзамен)
(1, 30, '2025-06-18', '5'),     -- Теория информации (экзамен)
(1, 31, '2025-06-20', '5'),     -- Интеллектуальный анализ данных (экзамен)
(1, 32, '2025-06-22', '5'),     -- Основы высокопроизводительных вычислений (экзамен)
(1, 33, '2025-06-24', '5'),     -- Математические основы ИИ (экзамен)

-- 3 курс, 5 семестр (декабрь 2025 - только что сдали)
(1, 34, '2025-12-05', 'зачет'), -- Правоведение (зачет)
(1, 35, '2025-12-10', '5'),     -- Математическая логика (экзамен)
(1, 36, '2025-12-12', '5'),     -- Основы электротехники (экзамен)
(1, 37, '2025-12-08', 'зачет'), -- Экономика программной инженерии (зачет)
(1, 38, '2025-12-14', '5'),     -- Основы нечеткой алгебры (экзамен)
(1, 39, '2025-12-16', '5'),     -- Базы данных (экзамен)
(1, 40, '2025-12-18', '5'),     -- Машинное обучение (экзамен)
(1, 41, '2025-12-10', 'зачет'), -- Методы визуализации данных (зачет)

-- Экзамены для второго студента (Иванов М.А.) - хорошист
-- 1 курс (сокращенно - основные предметы)
(2, 1, '2024-01-15', '4'),
(2, 4, '2024-01-14', 'зачет'),
(2, 5, '2024-01-20', '4'),
(2, 6, '2024-01-22', '5'),
(2, 9, '2024-01-28', '4'),
(2, 11, '2024-06-07', 'зачет'),
(2, 13, '2024-06-12', '4'),
(2, 15, '2024-06-16', '5'),
-- 2 курс
(2, 17, '2025-01-10', '4'),
(2, 18, '2025-01-08', 'зачет'),
(2, 19, '2025-01-12', '4'),
(2, 22, '2025-01-18', '5'),
(2, 26, '2025-06-10', '4'),
(2, 30, '2025-06-18', '4'),
-- 3 курс, 5 семестр
(2, 34, '2025-12-05', 'зачет'),
(2, 35, '2025-12-10', '4'),
(2, 39, '2025-12-16', '4'),

-- Экзамены для третьего студента (Ивенин А.А.) - троечник
-- 1 курс (сокращенно)
(3, 1, '2024-01-15', '3'),
(3, 2, '2024-01-10', 'зачет'),
(3, 5, '2024-01-20', '3'),
(3, 6, '2024-01-22', '4'),
(3, 9, '2024-01-28', '3'),
(3, 13, '2024-06-12', '3'),
-- 2 курс
(3, 17, '2025-01-10', '3'),
(3, 19, '2025-01-12', '3'),
(3, 22, '2025-01-18', '4'),
(3, 26, '2025-06-10', '3'),
-- 3 курс
(3, 34, '2025-12-05', 'зачет'),
(3, 35, '2025-12-10', '3'),

-- Маклаков С.А. (id=14) - отличник
(14, 1, '2024-01-15', '5'),
(14, 2, '2024-01-10', 'зачет'),
(14, 4, '2024-01-14', 'зачет'),
(14, 5, '2024-01-20', '5'),
(14, 6, '2024-01-22', '5'),
(14, 7, '2024-01-24', '5'),
(14, 9, '2024-01-28', '5'),
(14, 10, '2024-06-05', 'зачет'),
(14, 11, '2024-06-07', 'зачет'),
(14, 13, '2024-06-12', '5'),
(14, 15, '2024-06-16', '5'),
(14, 17, '2025-01-10', '5'),
(14, 18, '2025-01-08', 'зачет'),
(14, 19, '2025-01-12', '5'),
(14, 22, '2025-01-18', '5'),
(14, 25, '2025-06-05', 'зачет'),
(14, 26, '2025-06-10', '5'),
(14, 30, '2025-06-18', '5'),
(14, 34, '2025-12-05', 'зачет'),
(14, 35, '2025-12-10', '5'),
(14, 39, '2025-12-16', '5'),
(14, 40, '2025-12-18', '5'),

-- Полковников Д.А. (id=16)
(16, 1, '2024-01-15', '4'),
(16, 4, '2024-01-14', 'зачет'),
(16, 5, '2024-01-20', '4'),
(16, 6, '2024-01-22', '4'),
(16, 11, '2024-06-07', 'зачет'),
(16, 13, '2024-06-12', '3'),
(16, 17, '2025-01-10', '4'),
(16, 18, '2025-01-08', 'зачет'),
(16, 19, '2025-01-12', '4'),
(16, 25, '2025-06-05', 'зачет'),
(16, 26, '2025-06-10', '3'),
(16, 34, '2025-12-05', 'зачет'),
(16, 35, '2025-12-10', '4');

-- Создание индексов для оптимизации
CREATE INDEX idx_students_group_id ON students(group_id);
CREATE INDEX idx_exams_student_id ON exams(student_id);
CREATE INDEX idx_exams_discipline_id ON exams(discipline_id);
CREATE INDEX idx_disciplines_course_semester ON disciplines(course, semester);
